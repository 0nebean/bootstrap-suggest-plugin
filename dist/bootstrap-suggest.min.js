/**
 * bootstrap-suggest-plugin - v0.1.19
 * @description 这是一个基于 bootstrap 按钮式下拉菜单组件的搜索建议插件，必须使用于按钮式下拉菜单组件上。
 * @author [object Object]
 * @GitHub https://github.com/lzwme/bootstrap-suggest-plugin.git
 * @since 2017-07-03 10:57:02
 */
!function(a){if("function"==typeof define&&define.amd)define(["jquery"],a);else if("object"==typeof exports&&"object"==typeof module)a(require("jquery"));else{if(!window.jQuery)throw new Error("Not found jQuery.");a(window.jQuery)}}(function(a){function b(a,b){window.console&&window.console.trace&&(console.trace(a),b&&console.trace(b))}function c(a){return a.data()}function d(a,b){return b?a.attr("alt",b):a.attr("alt")}function e(a,b,c){if(b&&b.key){var d,e=c.separator||",";c&&c.multiWord?(d=a.val().split(e),d[d.length-1]=b.key,a.val(d.join(e)).focus()):a.attr("data-id",b.id).focus().val(b.key),a.trigger("onSetSelectValue",[b,(c.data.value||c._lastData.value)[b.index]])}}function f(a,b,c){if(b.is(":visible")){c.autoDropup&&setTimeout(function(){var c=b.parents(".input-group");w.height()+w.scrollTop()-a.offset().top<b.height()&&a.offset().top>b.height()+w.scrollTop()?c.addClass("dropup"):c.removeClass("dropup")},10);var d={},e=a.parent();return"left"===c.listAlign?d={left:a.siblings("div").width()-e.width(),right:"auto"}:"right"===c.listAlign&&(d={left:"auto",right:0}),x&&!c.showBtn&&(b.parents(".input-group").hasClass("dropup")?(d.top="auto",d.bottom=e.height()):(d.top=e.height(),d.bottom="auto")),c.autoMinWidth||(d["min-width"]=e.width()),b.css(d),a}}function g(a,b){var c,d,e;return b.indexId===-1&&!b.idField||b.multiWord?a:(c=a.css("background-color").replace(/ /g,"").split(",",3).join(","),d=b.inputBgColor||"rgba(255,255,255,0.1)",e=b.inputWarnColor||"rgba(255,255,0,0.1)",a.attr("data-id")||!a.val()?a.css("background",d):(~e.indexOf(c)||a.trigger("onUnsetSelectValue").css("background",e),a))}function h(a,b,c){var d,e,f=a.parent().find("tbody tr."+c.listHoverCSS);f.length&&(d=(f.index()+3)*f.height(),e=Number(b.css("max-height").replace("px","")),d>e||b.scrollTop()>e?d-=e:d=0,b.scrollTop(d))}function i(a,b){a.find("tr."+b.listHoverCSS).removeClass(b.listHoverCSS)}function j(a,b,c){return!(!b.length||a.data("bsSuggest"))&&(a.data("bsSuggest",{options:c}),!0)}function k(a){var c,d=!0;for(c in a)if("value"===c){d=!1;break}return d?(b("返回数据格式错误!"),!1):!!a.value.length&&a}function l(b,c){var d=c.effectiveFields;return!("__index"===b||d.length&&!~a.inArray(b,d))}function m(b,c){return~a.inArray(b,c.searchFields)}function n(a,b,c){var d,e,g,h,i,j,k=a.parent().find("ul.dropdown-menu"),m=0,n=['<table class="table table-condensed table-sm" style="margin:0">'];if(!b||!(d=b.value.length))return k.empty().hide(),a;var o=b.value;if(c._lastData&&JSON.stringify(c._lastData.value)===JSON.stringify(o)&&k.find("tr").length===d)return k.show(),f(a,k,c),a;if(c._lastData=b,c.showHeader){n.push("<thead><tr>");for(g in o[0])l(g,c)&&(n.push("<th>",c.effectiveFieldsAlias[g]||g,0===m?"("+d+")":"","</th>"),m++);n.push("</tr></thead>")}n.push("<tbody>");var p;for(e=0;e<d;e++){m=0,h=[],p=o[e],i=p[c.idField]||"",j=p[c.keyField]||"";for(g in p)j||c.indexKey!==m||(j=p[g]),i||c.indexId!==m||(i=p[g]),m++,l(g,c)&&h.push('<td data-name="',g,'">',p[g],"</td>");n.push('<tr data-index="',p.__index||e,'" data-id="',i,'" data-key="',j,'">',h.join(""),"</tr>")}return n.push("</tbody></table>"),k.html(n.join("")).show(),setTimeout(function(){if(!u){var a=k.find("table:eq(0)"),b=0,c=0;k.height()<a.height()&&Number(k.css("min-width").replace("px",""))<k.width()&&(b=18,c=20),k.css("padding-right",b),a.css("margin-bottom",c)}},301),f(a,k,c),a}function o(c,d){d=d||"";var e={type:"GET",dataType:c.jsonp?"jsonp":"json",timeout:5e3};return c.jsonp&&(e.jsonp=c.jsonp),a.isFunction(c.fnAdjustAjaxParam)&&(e=a.extend(e,c.fnAdjustAjaxParam(d,c))),e.url=function(){if(!d||e.data)return e.url||c.url;var a="?";return/=$/.test(c.url)?a="":/\?/.test(c.url)&&(a="&"),c.url+a+d}(),a.ajax(e).done(function(a){c.data=c.fnProcessData(a)}).fail(b)}function p(b,c,d,e){return d=a.trim(d),e.ignorecase&&(b=b.toLocaleLowerCase(),d=d.toLocaleLowerCase()),d&&(l(c,e)||m(c,e))&&(~d.indexOf(b)||e.twoWayMatch&&~b.indexOf(d))}function q(b,c,d,e){var f,g,h,i,j,l={value:[]};if(b=b||"",a.isFunction(e.fnPreprocessKeyword)&&(b=e.fnPreprocessKeyword(b,e)),e.url)o(e,b).done(function(a){d(c,e.data,e),c.trigger("onDataRequestSuccess",a),"firstByUrl"===e.getDataMethod&&(e.url=null)});else{if(f=e.data,g=k(f))if(b){for(j=f.value.length,h=0;h<j;h++)for(i in f.value[h])if(f.value[h][i]&&p(b,i,f.value[h][i]+"",e)){l.value.push(f.value[h]),l.value[l.value.length-1].__index=h;break}}else l=f;d(c,l,e)}}function r(a){return k(a)}function s(b,c){var d=b.prev("i.clearable");return c.clearable&&!d.length&&(d=a('<i class="clearable glyphicon glyphicon-remove"></i>').prependTo(b.parent())),d.css({position:"absolute",top:12,right:c.showBtn?(b.next(".input-group-btn").width()||33)+2:12,zIndex:4,cursor:"pointer",fontSize:12}).hide()}var t,u,v="0.1.19",w=a(window),x="ActiveXObject"in window,y=navigator.userAgent.match(/Chrome\/(\d+)/);y&&(y=Number(y[1])),u=x||y>51;var z={url:null,jsonp:null,data:{value:[]},indexId:0,indexKey:0,idField:"",keyField:"",autoSelect:!0,allowNoKeyword:!0,getDataMethod:"firstByUrl",delayUntilKeyup:!1,ignorecase:!1,effectiveFields:[],effectiveFieldsAlias:{},searchFields:[],twoWayMatch:!0,multiWord:!1,separator:",",delay:300,autoDropup:!1,autoMinWidth:!1,showHeader:!1,showBtn:!0,inputBgColor:"",inputWarnColor:"rgba(255,0,0,.1)",listStyle:{"padding-top":0,"max-height":"375px","max-width":"800px",overflow:"auto",width:"auto",transition:"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"},listAlign:"left",listHoverStyle:"background: #07d; color:#fff",listHoverCSS:"jhover",clearable:!1,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13,fnProcessData:r,fnGetData:q,fnAdjustAjaxParam:null,fnPreprocessKeyword:null},A={init:function(b){var k=this;return b=b||{},void 0===b.showHeader&&b.effectiveFields&&b.effectiveFields.length>1&&(b.showHeader=!0),b=a.extend(!0,{},z,b),b.processData&&(b.fnProcessData=b.processData),b.getData&&(b.fnGetData=b.getData),"firstByUrl"===b.getDataMethod&&b.url&&!b.delayUntilKeyup&&o(b).done(function(a){b.url=null,k.trigger("onDataRequestSuccess",a)}),a("#bsSuggest").length||a("head:eq(0)").append('<style id="bsSuggest">.'+b.listHoverCSS+"{"+b.listHoverStyle+"}</style>"),k.each(function(){var k,l,m=a(this),o=m.parent(),p=s(m,b),q=m.parents(".input-group").find("ul.dropdown-menu:eq(0)");return j(m,q,b)?(b.showBtn||m.css("border-radius","4px").parents(".input-group:eq(0)").css("width","100%").find(".btn:eq(0)").hide(),m.removeClass("disabled").prop("disabled",!1).attr("autocomplete","off"),q.css(b.listStyle),b.inputBgColor||(b.inputBgColor=m.css("background-color")),m.on("keydown",function(a){var f,g;if(q.is(":visible")){if(f=q.find("."+b.listHoverCSS),g="",i(q,b),a.keyCode===b.keyDown){if(f.length?f.next().length?g=c(f.next().mouseover()):b.autoSelect&&m.val(d(m)).attr("data-id",""):g=c(q.find("tbody tr:first").mouseover()),h(m,q,b),!b.autoSelect)return}else if(a.keyCode===b.keyUp){if(f.length?f.prev().length?g=c(f.prev().mouseover()):b.autoSelect&&m.val(d(m)).attr("data-id",""):g=c(q.find("tbody tr:last").mouseover()),h(m,q,b),!b.autoSelect)return}else a.keyCode===b.keyEnter?(g=c(f),q.hide().empty()):m.attr("data-id","");e(m,g,b)}}).on("compositionstart",function(a){t=!0}).on("compositionend",function(a){t=!1}).on("keyup input paste",function(c){var e;return~a.inArray(c.keyCode,[b.keyDown,b.keyUp,b.keyEnter])?(m.val(m.val()),void g(m,b)):(c.keyCode&&g(m,b),clearTimeout(l),void(l=setTimeout(function(){t||(e=m.val(),a.trim(e)&&e===d(m)||(d(m,e),b.multiWord&&(e=e.split(b.separator).reverse()[0]),(e.length||b.allowNoKeyword)&&b.fnGetData(a.trim(e),m,n,b)))},b.delay||300)))}).on("focus",function(){f(m,q,b)}).on("blur",function(){k||q.css("display","")}).on("click",function(){var c=m.val();return a.trim(c)&&c===d(m)&&q.find("table tr").length?q.show():void(q.is(":visible")||(b.multiWord&&(c=c.split(b.separator).reverse()[0]),(c.length||b.allowNoKeyword)&&b.fnGetData(a.trim(c),m,n,b)))}),o.find(".btn:eq(0)").attr("data-toggle","").click(function(){var a="none";return q.css("display")===a&&(a="block",b.url?(m.click().focus(),q.find("tr").length||(a="none")):n(m,b.data,b)),q.css("display",a),!1}),q.mouseenter(function(){k=1,m.blur()}).mouseleave(function(){k=0,m.focus()}).on("mouseenter","tbody tr",function(){return i(q,b),a(this).addClass(b.listHoverCSS),!1}).on("mousedown","tbody tr",function(){var f=c(a(this));e(m,f,b),d(m,f.key),g(m,b),q.hide()}),void(p.length&&(p.click(function(){m.val("").attr("data-id",""),g(m,b)}),o.mouseenter(function(){m.prop("disabled")||p.show()}).mouseleave(function(){p.hide()})))):void console.warn("不是一个标准的 bootstrap 下拉式菜单或已初始化:",m)})},show:function(){return this.each(function(){a(this).click()})},hide:function(){return this.each(function(){a(this).parent().find("ul.dropdown-menu").css("display","")})},disable:function(){return this.each(function(){a(this).attr("disabled",!0).parent().find(".btn:eq(0)").prop("disabled",!0)})},enable:function(){return this.each(function(){a(this).attr("disabled",!1).parent().find(".btn:eq(0)").prop("disabled",!1)})},destroy:function(){return this.each(function(){a(this).off().removeData("bsSuggest").removeAttr("style").parent().find(".btn:eq(0)").off().show().attr("data-toggle","dropdown").prop("disabled",!1).next().css("display","").off()})},version:function(){return v}};a.fn.bsSuggest=function(b){if("string"==typeof b&&A[b]){var c=!0;return this.each(function(){if(!a(this).data("bsSuggest"))return c=!1}),c||"init"===b||"version"===b?A[b].apply(this,[].slice.call(arguments,1)):this}return A.init.apply(this,arguments)}});